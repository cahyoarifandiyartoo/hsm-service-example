package com.example.hsmgenerateserviceexample.service;

import com.example.hsmgenerateserviceexample.util.HSM;
import org.springframework.stereotype.Service;

@Service
public class HSMService {

    public String getNewPINOffset(String vpan, String newPinDataBlock) {
        HSM HSMConnection = getHSMConnection();

        String pinOffset;
        String responseHSM = HSMConnection.getNewPINOffset(vpan.trim(), newPinDataBlock);

        if (responseHSM != null && responseHSM != "" && responseHSM.length() > 2) {
            pinOffset = responseHSM.substring(2);
        } else {
            pinOffset = null;
        }

        return pinOffset;
    }

    public String verifyPIN(String vpan, String pinDataBlock, String pinOffset) {
        HSM HSMConnection = getHSMConnection();

        return HSMConnection.verifyPIN(vpan, pinDataBlock, pinOffset);
    }

    public String getChangePINOffset(String vpan, String changePinDataBlock, String pinOffset) {
        HSM HSMConnection = getHSMConnection();

        return HSMConnection.getChangePINOffset(vpan, changePinDataBlock, pinOffset).substring(2);
    }

    private HSM getHSMConnection() {
        int hsmPort = 1500;
        String hsmIP = "117.54.139.227";
        String hsmpvk = "3036353687F9370CCFC046F4E817AEC8800DF2B5F1A827E7BB542EC299C6DD7EBFBFE84ABF0AB67C83CC07D80C03AEDC8FABFEF2B8B27DCAF9F1725BD93B92B27A326A631E8CA37A422A918FFC620DB15783F0D90B36633BB0B3E0540E529DB4D8E2C9EB0F8ECB0905DDAC1B9D50C4BC80564F9015A8A1220B8BC1743C252E26DADE0A0D53934319B8269FFA724C369DCF5BB3C89E2F869D74D6F6AACBCFB25DA8E1CF575B2C5847B03A15806B22016DE87CED2E81C55CB63B782FBB38FAC01699979B5F438D565148B2F56E7FA9389E1079375E8114AF22F5260A652D1B85870BE2D2DD2FC288D1A143DA731F254CCA5E6076D35F15D5EB0BE670E20E7B5FFC5A49C96E7A5D14BAF65F281F59E81CE3B82987DD3E7C520C8746839748EE71604626132851A0822F91932E8A21DCC240884AB93233A30E25F339B56AECF1A0F8777ED299D9410C73366EDFD3C1C48057D981D360B324468BF8354D68CE4DB6F95FB55F07C3BB0CBD7512FBAF17441F07FECCB4C3F06D65E8D8A049DA63AF1CCA559E6273064F48D3B749311675D6ED2BFA1839AEC5444EDE8A1D4E4A6D491533B7AC1CD0E8BB9796FF6F1E26CBEBCF4A7A043CECC856212126B6950A4712DC7060AF31E39163A3585403D77D1F04CD7702AB2075FBC08C677847648CD0D3BEFC8D2A298784B4D2A4B3BD45D4ABE1463FA3DD87513F79ED7C7F420E277C76D2FDA6EB729FC6E5F11C30C2806E6533D017AA5D7B53EC5386D5EF6636B663D4A2F1D7F10CF1F783FC76FC42FE45B79BD1753DFDDBF6201AC95C5840068EE081D6AE0D5AFD7721DC1D5A23C745F9356C5BE9E8CC4CF8C69DFFEEF41C22DFE2F4D1C17B7A9419E5EE059CCD2AAC8F5154067CBB909FEA462C8870DC7BB012C1B0A7A3A591B128966B10309A954B8553F4D46C3A950CB7";
        String hsm_PVK = "09E547136AD91E54";

        return new HSM(hsmIP, hsmPort, hsmpvk, hsm_PVK);
    }
}
